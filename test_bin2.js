require("./binnedData.js");
_ = require('underscore');
d3 = require("d3");

red = '\033[31m';
yellow = '\033[33m';
magenta = '\033[35m';
blue = '\033[36m';
reset = '\033[0m';

function dt (num) {
    var newdate = new Date();
    newdate.setTime(num);
    return newdate;
}

function inAButNotInB(arr1, arr2) {
    return _.filter(arr1, function (d) {
        return !_.contains(arr2, d);
    });
}

function assert(a, b, test) {
    if(inAButNotInB(a, b).length === 0 && inAButNotInB(b, a).length === 0) {
        console.log("+ Passed:", test);
    } else {
        console.log("- "+red+"Failed"+reset+":", test);
        console.log("    Result is", a);
        console.log("    Should be", b);
    }
}

function assertDirect(a, b, test) {
    if(typeof a  !== 'undefined' && a.toString().localeCompare(b.toString()) === 0) {
        console.log("+ Passed:", test);
    } else {
        console.log("- "+red+"Failed"+reset+":", test);
        console.log("  Result is", a);
        console.log("  Should be", b);
    }
}

var brd = binnedData().addRawData([
                                  {ms: 1000, val: 10},
                                  {ms: 1005, val: 12},
                                  {ms: 1010, val: 13},
]);

assert(_.pluck(brd.getDateRange(['rawData'], 0, [0, 2000]), 'ms'), [1000, 1005, 1010], 'adding raw and reading raw');
assert(_.pluck(brd.getDateRange(['average'], 1, [0, 2000]), 'ms'), [1000],  'adding raw and reading lvl 1a');
assert(_.pluck(brd.getDateRange(['average'], 1, [0, 2000]), 'val'), [11],   'adding raw and reading lvl 1b');
assertDirect(brd.getMax(1), 13, 'getMaxRaw');
assertDirect(brd.getMin(1), 10, 'getMinRaw');
assertDirect(brd.getMaxMS(1), 1010, 'getMaxRawMS');
assertDirect(brd.getMinMS(1), 1000, 'getMinRawMS');

// Missing in the middle.
var bird = binnedData().addRawData([
                                   {ms: 1000, val: 10},
                                   {ms: 1005, val: 10},
                                   {ms: 1010, val: 20},
                                   {ms: 1015, val: 20},
                                   {ms: 1030, val: 30},
                                   {ms: 1035, val: 30},
                                   {ms: 1040, val: 10},
                                   {ms: 1045, val: 10},
                                   {ms: 1050, val: 20},
                                   {ms: 1055, val: 20},
                                   {ms: 1060, val: 20},
                                   {ms: 1065, val: 20},
                                   {ms: 1070, val: 20},
                                   {ms: 1075, val: 20},
                                   {ms: 1080, val: 20},
                                   {ms: 1085, val: 20},
                                   {ms: 1090, val: 20},
                                   {ms: 1095, val: 20},
                                   {ms: 1100, val: 20},
                                   {ms: 1105, val: 20},
                                   {ms: 1110, val: 20},
                                   {ms: 1115, val: 20},
                                   {ms: 1120, val: 20},
                                   {ms: 1125, val: 20},
                                   {ms: 1130, val: 20},
                                   {ms: 1135, val: 20},
                                   {ms: 1140, val: 20},
                                   {ms: 1145, val: 20},
                                   {ms: 1150, val: 20},
                                   {ms: 1155, val: 20},
                                   {ms: 1160, val: 20},
                                   {ms: 1165, val: 20},
                                   {ms: 1170, val: 20},
                                   {ms: 1175, val: 20},
                                   {ms: 1180, val: 20},
                                   {ms: 1185, val: 20},
                                   {ms: 1190, val: 20},
                                   {ms: 1195, val: 20},
                                   {ms: 1200, val: 20},
                                   {ms: 1205, val: 20},
                                   {ms: 1210, val: 20},
                                   {ms: 1215, val: 20},
                                   {ms: 1220, val: 20},
                                   {ms: 1225, val: 20},
                                   {ms: 1230, val: 20},
                                   {ms: 1235, val: 20},
                                   {ms: 1240, val: 20},
                                   {ms: 1245, val: 20},
                                   {ms: 1250, val: 20},
                                   {ms: 1255, val: 20},
                                   {ms: 1260, val: 20},
                                   {ms: 1265, val: 20},
                                   {ms: 1270, val: 20},
                                   {ms: 1275, val: 20},
                                   {ms: 1280, val: 20},
                                   {ms: 1285, val: 20},
                                   {ms: 1290, val: 20},
                                   {ms: 1295, val: 20},
                                   {ms: 1300, val: 20},
                                   {ms: 1305, val: 20},
                                   {ms: 1310, val: 20},
                                   {ms: 1315, val: 20},
                                   {ms: 1320, val: 20},
                                   {ms: 1325, val: 20},
                                   {ms: 1330, val: 20},
                                   {ms: 1335, val: 20},
                                   {ms: 1340, val: 20},
                                   {ms: 1345, val: 20},
                                   {ms: 1350, val: 20},
                                   {ms: 1355, val: 20},
                                   {ms: 1360, val: 20},
                                   {ms: 1365, val: 20},
                                   {ms: 1370, val: 20},
                                   {ms: 1375, val: 20},
                                   {ms: 1380, val: 20},
                                   {ms: 1385, val: 20},
                                   {ms: 1390, val: 20},
                                   {ms: 1395, val: 20},
                                   {ms: 1400, val: 20},
                                   {ms: 1405, val: 20},
                                   {ms: 1410, val: 20},
                                   {ms: 1415, val: 20},
                                   {ms: 1420, val: 20},
                                   {ms: 1425, val: 20},
                                   {ms: 1430, val: 20},
                                   {ms: 1435, val: 20},
                                   {ms: 1440, val: 20},
                                   {ms: 1445, val: 20},
                                   {ms: 1450, val: 20},
                                   {ms: 1455, val: 20},
                                   {ms: 1460, val: 20},
                                   {ms: 1465, val: 20},
                                   {ms: 1470, val: 20},
                                   {ms: 1475, val: 20},
                                   {ms: 1480, val: 20},
                                   {ms: 1485, val: 20},
                                   {ms: 1490, val: 20},
                                   {ms: 1495, val: 20},
                                   {ms: 1500, val: 20},
                                   {ms: 1505, val: 20},
                                   {ms: 1510, val: 20},
                                   {ms: 1515, val: 20},
                                   {ms: 1520, val: 20},
                                   {ms: 1525, val: 20},
                                   {ms: 1530, val: 20},
                                   {ms: 1535, val: 20},
                                   {ms: 1540, val: 20},
                                   {ms: 1545, val: 20},
                                   {ms: 1550, val: 20},
                                   {ms: 1555, val: 20},
                                   {ms: 1560, val: 20},
                                   {ms: 1565, val: 20},
                                   {ms: 1570, val: 20},
                                   {ms: 1575, val: 20},
                                   {ms: 1580, val: 20},
                                   {ms: 1585, val: 20},
                                   {ms: 1590, val: 20},
                                   {ms: 1595, val: 20},
                                   {ms: 1600, val: 20},
                                   {ms: 1605, val: 20},
                                   {ms: 1610, val: 20},
                                   {ms: 1615, val: 20},
                                   {ms: 1620, val: 20},
                                   {ms: 1625, val: 20},
                                   {ms: 1630, val: 20},
                                   {ms: 1635, val: 20},
                                   {ms: 1640, val: 20},
                                   {ms: 1645, val: 20},
                                   {ms: 1650, val: 20},
                                   {ms: 1655, val: 20},
                                   {ms: 1660, val: 20},
                                   {ms: 1665, val: 20},
                                   {ms: 1670, val: 20},
                                   {ms: 1675, val: 20},
                                   {ms: 1680, val: 20},
                                   {ms: 1685, val: 20},
                                   {ms: 1690, val: 20},
                                   {ms: 1695, val: 20},
                                   {ms: 1700, val: 20},
                                   {ms: 1705, val: 20},
                                   {ms: 1710, val: 20},
                                   {ms: 1715, val: 20},
                                   {ms: 1720, val: 20},
                                   {ms: 1725, val: 20},
                                   {ms: 1730, val: 20},
                                   {ms: 1735, val: 20},
                                   {ms: 1740, val: 20},
                                   {ms: 1745, val: 20},
                                   {ms: 1750, val: 20},
                                   {ms: 1755, val: 20},
                                   {ms: 1760, val: 20},
                                   {ms: 1765, val: 20},
                                   {ms: 1770, val: 20},
                                   {ms: 1775, val: 20},
                                   {ms: 1780, val: 20},
                                   {ms: 1785, val: 20},
                                   {ms: 1790, val: 20},
                                   {ms: 1795, val: 20},
                                   {ms: 1800, val: 20},
                                   {ms: 1805, val: 20},
                                   {ms: 1810, val: 20},
                                   {ms: 1815, val: 20},
                                   {ms: 1820, val: 20},
                                   {ms: 1825, val: 20},
                                   {ms: 1830, val: 20},
                                   {ms: 1835, val: 20},
                                   {ms: 1840, val: 20},
                                   {ms: 1845, val: 20},
                                   {ms: 1850, val: 20},
                                   {ms: 1855, val: 20},
                                   {ms: 1860, val: 20},
                                   {ms: 1865, val: 20},
                                   {ms: 1870, val: 20},
                                   {ms: 1875, val: 20},
                                   {ms: 1880, val: 20},
                                   {ms: 1885, val: 20},
                                   {ms: 1890, val: 20},
                                   {ms: 1895, val: 20},
                                   {ms: 1900, val: 20},
                                   {ms: 1905, val: 20},
                                   {ms: 1910, val: 20},
                                   {ms: 1915, val: 20},
                                   {ms: 1920, val: 20},
                                   {ms: 1925, val: 20},
                                   {ms: 1930, val: 20},
                                   {ms: 1935, val: 20},
                                   {ms: 1940, val: 20},
                                   {ms: 1945, val: 20},
                                   {ms: 1950, val: 20},
                                   {ms: 1955, val: 20},
                                   {ms: 1960, val: 20},
                                   {ms: 1965, val: 20},
                                   {ms: 1970, val: 20},
                                   {ms: 1975, val: 20},
                                   {ms: 1980, val: 20},
                                   {ms: 1985, val: 20},
                                   {ms: 1990, val: 20},
                                   {ms: 1995, val: 20},
                                   {ms: 2000, val: 20},
                                   {ms: 2005, val: 20},
                                   {ms: 2010, val: 20},
                                   {ms: 2015, val: 20},
                                   {ms: 2020, val: 20},
                                   {ms: 2025, val: 20},
                                   {ms: 2030, val: 20},
                                   {ms: 2035, val: 20},
                                   {ms: 2040, val: 20},
                                   {ms: 2045, val: 20},
                                   {ms: 2050, val: 20},
                                   {ms: 2055, val: 20},
                                   {ms: 2060, val: 20},
                                   {ms: 2065, val: 20},
                                   {ms: 101000, val: 10},
                                   {ms: 101005, val: 10},
                                   {ms: 101010, val: 20},
                                   {ms: 101015, val: 20},
                                   {ms: 101030, val: 30},
                                   {ms: 101035, val: 30},
                                   {ms: 101040, val: 10},
                                   {ms: 101045, val: 10},
                                   {ms: 101050, val: 20},
                                   {ms: 101055, val: 20},
                                   {ms: 101060, val: 20},
                                   {ms: 101065, val: 20},
                                   {ms: 101070, val: 20},
                                   {ms: 101075, val: 20},
                                   {ms: 101080, val: 20},
                                   {ms: 101085, val: 20},
                                   {ms: 101090, val: 20},
                                   {ms: 101095, val: 20},
                                   {ms: 101100, val: 20},
                                   {ms: 101105, val: 20},
                                   {ms: 101110, val: 20},
                                   {ms: 101115, val: 20},
                                   {ms: 101120, val: 20},
                                   {ms: 101125, val: 20},
                                   {ms: 101130, val: 20},
                                   {ms: 101135, val: 20},
                                   {ms: 101140, val: 20},
                                   {ms: 101145, val: 20},
                                   {ms: 101150, val: 20},
                                   {ms: 101155, val: 20},
                                   {ms: 101160, val: 20},
                                   {ms: 101165, val: 20},
                                   {ms: 101170, val: 20},
                                   {ms: 101175, val: 20},
                                   {ms: 101180, val: 20},
                                   {ms: 101185, val: 20},
                                   {ms: 101190, val: 20},
                                   {ms: 101195, val: 20},
                                   {ms: 101200, val: 20},
                                   {ms: 101205, val: 20},
                                   {ms: 101210, val: 20},
                                   {ms: 101215, val: 20},
                                   {ms: 101220, val: 20},
                                   {ms: 101225, val: 20},
                                   {ms: 101230, val: 20},
                                   {ms: 101235, val: 20},
                                   {ms: 101240, val: 20},
                                   {ms: 101245, val: 20},
                                   {ms: 101250, val: 20},
                                   {ms: 101255, val: 20},
                                   {ms: 101260, val: 20},
                                   {ms: 101265, val: 20},
                                   {ms: 101270, val: 20},
                                   {ms: 101275, val: 20},
                                   {ms: 101280, val: 20},
                                   {ms: 101285, val: 20},
                                   {ms: 101290, val: 20},
                                   {ms: 101295, val: 20},
                                   {ms: 101300, val: 20},
                                   {ms: 101305, val: 20},
                                   {ms: 101310, val: 20},
                                   {ms: 101315, val: 20},
                                   {ms: 101320, val: 20},
                                   {ms: 101325, val: 20},
                                   {ms: 101330, val: 20},
                                   {ms: 101335, val: 20},
                                   {ms: 101340, val: 20},
                                   {ms: 101345, val: 20},
                                   {ms: 101350, val: 20},
                                   {ms: 101355, val: 20},
                                   {ms: 101360, val: 20},
                                   {ms: 101365, val: 20},
                                   {ms: 101370, val: 20},
                                   {ms: 101375, val: 20},
                                   {ms: 101380, val: 20},
                                   {ms: 101385, val: 20},
                                   {ms: 101390, val: 20},
                                   {ms: 101395, val: 20},
                                   {ms: 101400, val: 20},
                                   {ms: 101405, val: 20},
                                   {ms: 101410, val: 20},
                                   {ms: 101415, val: 20},
                                   {ms: 101420, val: 20},
                                   {ms: 101425, val: 20},
                                   {ms: 101430, val: 20},
                                   {ms: 101435, val: 20},
                                   {ms: 101440, val: 20},
                                   {ms: 101445, val: 20},
                                   {ms: 101450, val: 20},
                                   {ms: 101455, val: 20},
                                   {ms: 101460, val: 20},
                                   {ms: 101465, val: 20},
                                   {ms: 101470, val: 20},
                                   {ms: 101475, val: 20},
                                   {ms: 101480, val: 20},
                                   {ms: 101485, val: 20},
                                   {ms: 101490, val: 20},
                                   {ms: 101495, val: 20},
                                   {ms: 101500, val: 20},
                                   {ms: 101505, val: 20},
                                   {ms: 101510, val: 20},
                                   {ms: 101515, val: 20},
                                   {ms: 101520, val: 20},
                                   {ms: 101525, val: 20},
                                   {ms: 101530, val: 20},
                                   {ms: 101535, val: 20},
                                   {ms: 101540, val: 20},
                                   {ms: 101545, val: 20},
                                   {ms: 101550, val: 20},
                                   {ms: 101555, val: 20},
                                   {ms: 101560, val: 20},
                                   {ms: 101565, val: 20},
                                   {ms: 101570, val: 20},
                                   {ms: 101575, val: 20},
                                   {ms: 101580, val: 20},
                                   {ms: 101585, val: 20},
                                   {ms: 101590, val: 20},
                                   {ms: 101595, val: 20},
                                   {ms: 101600, val: 20},
                                   {ms: 101605, val: 20},
                                   {ms: 101610, val: 20},
                                   {ms: 101615, val: 20},
                                   {ms: 101620, val: 20},
                                   {ms: 101625, val: 20},
                                   {ms: 101630, val: 20},
                                   {ms: 101635, val: 20},
                                   {ms: 101640, val: 20},
                                   {ms: 101645, val: 20},
                                   {ms: 101650, val: 20},
                                   {ms: 101655, val: 20},
                                   {ms: 101660, val: 20},
                                   {ms: 101665, val: 20},
                                   {ms: 101670, val: 20},
                                   {ms: 101675, val: 20},
                                   {ms: 101680, val: 20},
                                   {ms: 101685, val: 20},
                                   {ms: 101690, val: 20},
                                   {ms: 101695, val: 20},
                                   {ms: 101700, val: 20},
                                   {ms: 101705, val: 20},
                                   {ms: 101710, val: 20},
                                   {ms: 101715, val: 20},
                                   {ms: 101720, val: 20},
                                   {ms: 101725, val: 20},
                                   {ms: 101730, val: 20},
                                   {ms: 101735, val: 20},
                                   {ms: 101740, val: 20},
                                   {ms: 101745, val: 20},
                                   {ms: 101750, val: 20},
                                   {ms: 101755, val: 20},
                                   {ms: 101760, val: 20},
                                   {ms: 101765, val: 20},
                                   {ms: 101770, val: 20},
                                   {ms: 101775, val: 20},
                                   {ms: 101780, val: 20},
                                   {ms: 101785, val: 20},
                                   {ms: 101790, val: 20},
                                   {ms: 101795, val: 20},
                                   {ms: 101800, val: 20},
                                   {ms: 101805, val: 20},
                                   {ms: 101810, val: 20},
                                   {ms: 101815, val: 20},
                                   {ms: 101820, val: 20},
                                   {ms: 101825, val: 20},
                                   {ms: 101830, val: 20},
                                   {ms: 101835, val: 20},
                                   {ms: 101840, val: 20},
                                   {ms: 101845, val: 20},
                                   {ms: 101850, val: 20},
                                   {ms: 101855, val: 20},
                                   {ms: 101860, val: 20},
                                   {ms: 101865, val: 20},
                                   {ms: 101870, val: 20},
                                   {ms: 101875, val: 20},
                                   {ms: 101880, val: 20},
                                   {ms: 101885, val: 20},
                                   {ms: 101890, val: 20},
                                   {ms: 101895, val: 20},
                                   {ms: 101900, val: 20},
                                   {ms: 101905, val: 20},
                                   {ms: 101910, val: 20},
                                   {ms: 101915, val: 20},
                                   {ms: 101920, val: 20},
                                   {ms: 101925, val: 20},
                                   {ms: 101930, val: 20},
                                   {ms: 101935, val: 20},
                                   {ms: 101940, val: 20},
                                   {ms: 101945, val: 20},
                                   {ms: 101950, val: 20},
                                   {ms: 101955, val: 20},
                                   {ms: 101960, val: 20},
                                   {ms: 101965, val: 20},
                                   {ms: 101970, val: 20},
                                   {ms: 101975, val: 20},
                                   {ms: 101980, val: 20},
                                   {ms: 101985, val: 20},
                                   {ms: 101990, val: 20},
                                   {ms: 101995, val: 20},
                                   {ms: 201000, val: 10},
                                   {ms: 201005, val: 10},
                                   {ms: 201010, val: 20},
                                   {ms: 201015, val: 20},
                                   {ms: 201030, val: 30},
                                   {ms: 201035, val: 30},
                                   {ms: 201040, val: 10},
                                   {ms: 201045, val: 10},
                                   {ms: 201050, val: 20},
                                   {ms: 201055, val: 20},
                                   {ms: 201060, val: 20},
                                   {ms: 201065, val: 20},
                                   {ms: 201070, val: 20},
                                   {ms: 201075, val: 20},
                                   {ms: 201080, val: 20},
                                   {ms: 201085, val: 20},
                                   {ms: 201090, val: 20},
                                   {ms: 201095, val: 20},
                                   {ms: 201100, val: 20},
                                   {ms: 201105, val: 20},
                                   {ms: 201110, val: 20},
                                   {ms: 201115, val: 20},
                                   {ms: 201120, val: 20},
                                   {ms: 201125, val: 20},
                                   {ms: 201130, val: 20},
                                   {ms: 201135, val: 20},
                                   {ms: 201140, val: 20},
                                   {ms: 201145, val: 20},
                                   {ms: 201150, val: 20},
                                   {ms: 201155, val: 20},
                                   {ms: 201160, val: 20},
                                   {ms: 201165, val: 20},
                                   {ms: 201170, val: 20},
                                   {ms: 201175, val: 20},
                                   {ms: 201180, val: 20},
                                   {ms: 201185, val: 20},
                                   {ms: 201190, val: 20},
                                   {ms: 201195, val: 20},
                                   {ms: 201200, val: 20},
                                   {ms: 201205, val: 20},
                                   {ms: 201210, val: 20},
                                   {ms: 201215, val: 20},
                                   {ms: 201220, val: 20},
                                   {ms: 201225, val: 20},
                                   {ms: 201230, val: 20},
                                   {ms: 201235, val: 20},
                                   {ms: 201240, val: 20},
                                   {ms: 201245, val: 20},
                                   {ms: 201250, val: 20},
                                   {ms: 201255, val: 20},
                                   {ms: 201260, val: 20},
                                   {ms: 201265, val: 20},
                                   {ms: 201270, val: 20},
                                   {ms: 201275, val: 20},
                                   {ms: 201280, val: 20},
                                   {ms: 201285, val: 20},
                                   {ms: 201290, val: 20},
                                   {ms: 201295, val: 20},
                                   {ms: 201300, val: 20},
                                   {ms: 201305, val: 20},
                                   {ms: 201310, val: 20},
                                   {ms: 201315, val: 20},
                                   {ms: 201320, val: 20},
                                   {ms: 201325, val: 20},
                                   {ms: 201330, val: 20},
                                   {ms: 201335, val: 20},
                                   {ms: 201340, val: 20},
                                   {ms: 201345, val: 20},
                                   {ms: 201350, val: 20},
                                   {ms: 201355, val: 20},
                                   {ms: 201360, val: 20},
                                   {ms: 201365, val: 20},
                                   {ms: 201370, val: 20},
                                   {ms: 201375, val: 20},
                                   {ms: 201380, val: 20},
                                   {ms: 201385, val: 20},
                                   {ms: 201390, val: 20},
                                   {ms: 201395, val: 20},
                                   {ms: 201400, val: 20},
                                   {ms: 201405, val: 20},
                                   {ms: 201410, val: 20},
                                   {ms: 201415, val: 20},
                                   {ms: 201420, val: 20},
                                   {ms: 201425, val: 20},
                                   {ms: 201430, val: 20},
                                   {ms: 201435, val: 20},
                                   {ms: 201440, val: 20},
                                   {ms: 201445, val: 20},
                                   {ms: 201450, val: 20},
                                   {ms: 201455, val: 20},
                                   {ms: 201460, val: 20},
                                   {ms: 201465, val: 20},
                                   {ms: 201470, val: 20},
                                   {ms: 201475, val: 20},
                                   {ms: 201480, val: 20},
                                   {ms: 201485, val: 20},
                                   {ms: 201490, val: 20},
                                   {ms: 201495, val: 20},
                                   {ms: 201500, val: 20},
                                   {ms: 201505, val: 20},
                                   {ms: 201510, val: 20},
                                   {ms: 201515, val: 20},
                                   {ms: 201520, val: 20},
                                   {ms: 201525, val: 20},
                                   {ms: 201530, val: 20},
                                   {ms: 201535, val: 20},
                                   {ms: 201540, val: 20},
                                   {ms: 201545, val: 20},
                                   {ms: 201550, val: 20},
                                   {ms: 201555, val: 20},
                                   {ms: 201560, val: 20},
                                   {ms: 201565, val: 20},
                                   {ms: 201570, val: 20},
                                   {ms: 201575, val: 20},
                                   {ms: 201580, val: 20},
                                   {ms: 201585, val: 20},
                                   {ms: 201590, val: 20},
                                   {ms: 201595, val: 20},
                                   {ms: 201600, val: 20},
                                   {ms: 201605, val: 20},
                                   {ms: 201610, val: 20},
                                   {ms: 201615, val: 20},
                                   {ms: 201620, val: 20},
                                   {ms: 201625, val: 20},
                                   {ms: 201630, val: 20},
                                   {ms: 201635, val: 20},
                                   {ms: 201640, val: 20},
                                   {ms: 201645, val: 20},
                                   {ms: 201650, val: 20},
                                   {ms: 201655, val: 20},
                                   {ms: 201660, val: 20},
                                   {ms: 201665, val: 20},
                                   {ms: 201670, val: 20},
                                   {ms: 201675, val: 20},
                                   {ms: 201680, val: 20},
                                   {ms: 201685, val: 20},
                                   {ms: 201690, val: 20},
                                   {ms: 201695, val: 20},
                                   {ms: 201700, val: 20},
                                   {ms: 201705, val: 20},
                                   {ms: 201710, val: 20},
                                   {ms: 201715, val: 20},
                                   {ms: 201720, val: 20},
                                   {ms: 201725, val: 20},
                                   {ms: 201730, val: 20},
                                   {ms: 201735, val: 20},
                                   {ms: 201740, val: 20},
                                   {ms: 201745, val: 20},
                                   {ms: 201750, val: 20},
                                   {ms: 201755, val: 20},
                                   {ms: 201760, val: 20},
                                   {ms: 201765, val: 20},
                                   {ms: 201770, val: 20},
                                   {ms: 201775, val: 20},
                                   {ms: 201780, val: 20},
                                   {ms: 201785, val: 20},
                                   {ms: 201790, val: 20},
                                   {ms: 201795, val: 20},
                                   {ms: 201800, val: 20},
                                   {ms: 201805, val: 20},
                                   {ms: 201810, val: 20},
                                   {ms: 201815, val: 20},
                                   {ms: 201820, val: 20},
                                   {ms: 201825, val: 20},
                                   {ms: 201830, val: 20},
                                   {ms: 201835, val: 20},
                                   {ms: 201840, val: 20},
                                   {ms: 201845, val: 20},
                                   {ms: 201850, val: 20},
                                   {ms: 201855, val: 20},
                                   {ms: 201860, val: 20},
                                   {ms: 201865, val: 20},
                                   {ms: 201870, val: 20},
                                   {ms: 201875, val: 20},
                                   {ms: 201880, val: 20},
                                   {ms: 201885, val: 20},
                                   {ms: 201890, val: 20},
                                   {ms: 201895, val: 20},
                                   {ms: 201900, val: 20},
                                   {ms: 201905, val: 20},
                                   {ms: 201910, val: 20},
                                   {ms: 201915, val: 20},
                                   {ms: 201920, val: 20},
                                   {ms: 201925, val: 20},
                                   {ms: 201930, val: 20},
                                   {ms: 201935, val: 20},
                                   {ms: 201940, val: 20},
                                   {ms: 201945, val: 20},
                                   {ms: 201950, val: 20},
                                   {ms: 201955, val: 20},
                                   {ms: 201960, val: 20},
                                   {ms: 201965, val: 20},
                                   {ms: 201970, val: 20},
                                   {ms: 201975, val: 20},
                                   {ms: 201980, val: 20},
                                   {ms: 201985, val: 20},
                                   {ms: 201990, val: 20},
                                   {ms: 201995, val: 20},
]);

assert(_.flatten(bird.missingBins([1000, 1050], 0)), [1020, 1025, 1025, 1030], 'Missing Data In Middle: lvl 0 raw data');

// No missing data.
var burd = binnedData().addRawData([
                                   {ms: 1000, val: 10},
                                   {ms: 1005, val: 10},
                                   {ms: 1010, val: 20},
                                   {ms: 1015, val: 20},
                                   {ms: 1020, val: 20},
                                   {ms: 1025, val: 20},
                                   {ms: 1030, val: 30},
                                   {ms: 1035, val: 30},
                                   {ms: 1040, val: 10},
                                   {ms: 1045, val: 10},
                                   {ms: 1050, val: 20},
                                   {ms: 1055, val: 20},
]);

assert(_.flatten(burd.missingBins([1000, 1055], 0)), [], 'No Missing Data: lvl 0 raw data')
assert(_.pluck(burd.getDateRange(['average'], 1, [0, 2000]), 'ms'), [1000, 1010, 1020, 1030, 1040, 1050], 'No Missing Data: lvl 1 bins');
assert([burd.getDateRange(['average'], 0, [0, 2000]).length], [12], 'No Missing Data: lvl 0 length');
assert([burd.getDateRange(['average'], 1, [0, 2000]).length], [6], 'No Missing Data: lvl 1 length');
assert([burd.getDateRange(['average'], 2, [0, 2000]).length], [3], 'No Missing Data: lvl 2 length');

// Missing at end
assert(_.flatten(burd.missingBins([1000, 1065], 0)), [1060, 1065, 1065, 1070], 'missing at end');

// Missing at start
assert(_.flatten(burd.missingBins([990, 1055], 0)), [990, 995, 995, 1000], 'Missing Start: raw data');

var bord = binnedData().addRawData([
                                   {ms: 1005, val: 10},
                                   {ms: 1010, val: 20},
                                   {ms: 1015, val: 20},
                                   {ms: 1020, val: 20},
                                   {ms: 1040, val: 10},
                                   {ms: 1045, val: 10},
                                   {ms: 1050, val: 20},
                                   {ms: 1055, val: 20},
]);

// No missing data.
var burd = binnedData().addRawData([
                                   {ms: 1005, val: 10},
                                   {ms: 1010, val: 20},
                                   {ms: 1015, val: 20},
                                   {ms: 1020, val: 20},
                                   {ms: 1025, val: 20},
                                   {ms: 1030, val: 30},
                                   {ms: 1035, val: 30},
                                   {ms: 1040, val: 10},
                                   {ms: 1045, val: 10},
                                   {ms: 1050, val: 20},
                                   {ms: 1055, val: 20},
]);

assert(_.flatten(burd.missingBins([1000, 1050], 0)), [1000, 1005], 'Missing Start: lvl 0 raw data');
assert(_.pluck(burd.getDateRange(['average'], 1, [0, 2000]), 'ms'), [1010, 1020, 1030, 1040, 1050], 'Missing Start: lvl 1 bins');
assert(_.flatten(burd.missingBins([1000, 1050], 1)), [1000, 1010], 'Missing Start: lvl 1 missing bins');

assert(_.pluck(burd.getDateRange(['average'], 0, [0, 2000]), 'ms'), [1005, 1010, 1015, 1020, 1025, 1030, 1035, 1040, 1045, 1050, 1055], 'Missing End: bin check');
assert(_.flatten(burd.missingBins([1010, 1060], 0)), [1060, 1065], 'Missing End: lvl 0 raw data');
assert(_.flatten(burd.missingBins([1010, 1060], 1)), [1060, 1070], 'Missing End: lvl 1 missing bins');


var bard = binnedData().addRawData([
                                   {ms: 1005, val: 10},
                                   {ms: 1010, val: 20},
                                   {ms: 1015, val: 20},
                                   {ms: 1020, val: 20},
                                   {ms: 1040, val: 10},
                                   {ms: 1045, val: 10},
                                   {ms: 1050, val: 20},
                                   {ms: 1055, val: 20},
]);

assert(_.pluck(bard.getDateRange(['average'], 1, [0, 2000]), 'ms'), [1010, 1040, 1050], 'Missing At Start And Middle: lvl 1 bins');
assert(_.flatten(bard.missingBins([1000, 1050], 1)), [1000, 1010, 1020, 1030, 1030, 1040], 'Missing At Start And Middle: lvl 1 missing bins');
assert(_.flatten(bard.missingBins([1001, 1046], 1)), [1000, 1010, 1020, 1030, 1030, 1040], 'Missing At Start And Middle: lvl 1 missing bins with a non5mod range');


var bard = binnedData().addRawData([
                                   {ms: 5,  val: 1},
                                   {ms: 10, val: 2},
                                   {ms: 15, val: 2},
                                   {ms: 20, val: 2},
                                   {ms: 40, val: 1},
                                   {ms: 45, val: 1},
                                   {ms: 50, val: 2},
                                   {ms: 55, val: 2},
]);

//assert(_.flatten(bard.missingRawBinsUnderThisRangeAndLevel([20, 40], 2)), [0, 10, 20, 30, 30, 40], 'raw bins required under level');




