shmotg=function(){return{MAX_NUMBER_OF_BIN_LEVELS:46,MAX_NUMBER_OF_ITEMS_PER_ARRAY:32,TIME_CONTEXT_VERTICAL_EACH:25}}(); (function(){var a=function(){return d3.interpolateString("rotate(0)","rotate(360)")};loader=function(){function b(a){q=a;a.each(function(d,c){var a=d3.select(this);s=s?s:a.append("svg").attr("width",m).attr("height",n);a=Math.min(m,n)/2;a=d3.svg.arc().innerRadius(a*k).outerRadius(a*h).startAngle(0);f=s.append("g").attr("transform","translate("+m/2+","+n/2+")").append("path").datum({endAngle:0.33*e}).style("fill","#4D4D4D").attr("d",a).call(g,1500)});d3.timer.flush()}var e=2*Math.PI,k=0.5,h=0.9,m= 25,n=25,r=!0,q,s,f,g=function(b,d){r&&(b.transition().ease("linear").duration(d).attrTween("transform",a),setTimeout(g,d,b,d))};b.width=function(a){if(!arguments.length)return m;m=a;return b};b.height=function(a){if(!arguments.length)return n;n=a;return b};b.update=function(){b(q)};b.isShowing=function(a){if(!arguments.length)return r;a&&!r&&(r=!0,g(f,1500));r=a;return b};return b}})(); msToCentury=function(){function a(d){var c=new Date;c.setTime(d);return c}function b(d){var c=new Date;c.setTime(k(d,f.ms));return c}function e(d,c){return Math.ceil(d/c)*c}function k(d,c){return Math.floor(d/c)*c}function h(d){var c=d.getMonth();d=1<=(c+1)/12?d.getFullYear()+1:d.getFullYear();c=new Date(d,(c+1)%12,1,1,1,1,1);c=a(c.getTime()-4E6);return c.getDate()}function m(d,c){for(var a=function(c){return c<d[1]&&c>d[0]},g=0;g<l.length;g++){var b=l[g];if(d[1]-d[0]<=b[0]*b[1]*c/s)return b=r(d[0], d[1],b[1],b[3],b[2],b[0]*b[1],c),b=_.filter(b,a),g}return-1}function n(d,c){var a=d.domain(),a=m(a,c);if(-1===a)return 0;a=l[a][1];return a/g[a]}function r(d,c,g,b,l,f,k){return b===d3.time.year?(d=d3.time.year.floor(a(d)),c=d3.time.year.ceil(a(c)),c=d3.range(d.getFullYear(),c.getFullYear()),c=_.filter(c,function(c){return 0===c%g}),c=_.map(c,function(c){return(new Date(c,0)).getTime()})):b===d3.time.month?(d=d3.time.year.floor(a(d)),c=d3.time.year.ceil(a(c)),c=d3.range(d.getFullYear(),c.getFullYear()), c=_.map(c,function(c){return _.map([0,1,2,3,4,5,6,7,8,9,10,11],function(d){return(new Date(c,d)).getTime()})}),c=_.flatten(c),c=_.filter(c,function(c,d){return 0===d%g})):l===d3.time.month?(d=d3.time.year.floor(a(d)),c=d3.time.year.ceil(a(c)),c=d3.range(d.getFullYear(),c.getFullYear()),c=_.map(c,function(c){return _.map([0,1,2,3,4,5,6,7,8,9,10,11],function(d){var a=h(new Date(c,d));return _.map(d3.range(1,a+1),function(b){return 0===(b-1)%g&&a+1-b>=g?(new Date(c,d,b)).getTime():[]})})}),c=_.flatten(c)): d3.range(l.floor(a(d)).getTime(),l.ceil(a(c)).getTime(),e(f*s/k,f))}var q={},s=100,f={ms:1,s:1E3,m:6E4,h:36E5,d:864E5,mo:2592E6,y:31536E6};q.times=f;q.NumberOfDaysInYear=function(d){var c=new Date(d.getFullYear(),0,0);d=(new Date(d.getFullYear()+1,0,0)).getTime()-c.getTime();return Math.floor(d/864E5)};q.TickFormat=function(d){return function(c){return function(d){var a=new Date;a.setTime(d);d=c.length-1;for(var g=c[d];!g[1](a);)g=c[--d];return g[0](a)}}([[d3.time.format("%Y"),function(){return!0}], [d3.time.format("%b"),function(c){return c.getMonth()}],[function(c){return d3.time.format("%a %-d")(c).toLowerCase()},function(c){return 1!=c.getDate()}],[d3.time.format("%H:00"),function(c){return c.getHours()}],[d3.time.format("%H:%M"),function(c){return c.getMinutes()}],[d3.time.format("%Ss"),function(c){return c.getSeconds()}],[d3.time.format("%Lms"),function(c){return c.getMilliseconds()}]])(d)};q.TickValues=function(d,c){var a=d.domain(),g=m(a,c);if(-1===g)return[1,10,100,1E3,1E4,1E5,1E6,1E7, 1E8,1E9,1E10,1E11,1E12,1E13,1E14];g=l[g];g=r(a[0],a[1],g[1],g[3],g[2],g[0]*g[1],c);return _.filter(g,function(c){return c<a[1]&&c>a[0]})};q.SubTickValues=function(d,c){var a=d.domain(),g=m(a,c);if(-1===g)return[1,10,100,1E3,1E4,1E5,1E6,1E7,1E8,1E9,1E10,1E11,1E12,1E13,1E14];for(var b=l[g],g=r(a[0],a[1],b[1],b[3],b[2],b[0]*b[1],c),e=[],f=n(d,c),k=d3.range(1,f),b=b[0]*b[1],h=0;h<k.length;h++)e.push(g[0]-b/f*k[h]);for(h=0;h<g.length;h++)for(var q=0;q<k.length;q++)e.push(g[h]+b/f*k[q]);return _.filter(e, function(c){return c<a[1]&&c>a[0]})};var g={1:0.5,2:1,3:1,5:1,6:3,10:5,12:3,15:5,20:5,25:5,30:10,50:10,100:50,200:50,500:100},l=[[f.ms,1,d3.time.second,b],[f.ms,2,d3.time.second,b],[f.ms,5,d3.time.second,b],[f.ms,10,d3.time.second,b],[f.ms,20,d3.time.second,b],[f.ms,50,d3.time.second,b],[f.ms,100,d3.time.second,b],[f.ms,200,d3.time.second,b],[f.ms,500,d3.time.second,b],[f.s,1,d3.time.minute,d3.time.second],[f.s,2,d3.time.minute,d3.time.second],[f.s,5,d3.time.minute,d3.time.second],[f.s,15,d3.time.minute, d3.time.second],[f.s,30,d3.time.minute,d3.time.second],[f.m,1,d3.time.hour,d3.time.minute],[f.m,2,d3.time.hour,d3.time.minute],[f.m,5,d3.time.hour,d3.time.minute],[f.m,15,d3.time.hour,d3.time.minute],[f.m,30,d3.time.hour,d3.time.minute],[f.h,1,d3.time.day,d3.time.hour],[f.h,3,d3.time.day,d3.time.hour],[f.h,6,d3.time.day,d3.time.hour],[f.h,12,d3.time.day,d3.time.hour],[f.d,1,d3.time.month,d3.time.day],[f.d,2,d3.time.month,d3.time.day],[f.d,5,d3.time.month,d3.time.day],[f.d,10,d3.time.month,d3.time.day], [f.d,15,d3.time.month,d3.time.day],[f.mo,1,d3.time.year,d3.time.month],[f.mo,2,d3.time.year,d3.time.month],[f.mo,3,d3.time.year,d3.time.month],[f.mo,6,d3.time.year,d3.time.month],[f.mo,12,d3.time.year,d3.time.month],[f.y,1,d3.time.year,d3.time.year],[f.y,2,d3.time.year,d3.time.year],[f.y,5,d3.time.year,d3.time.year],[f.y,10,d3.time.year,d3.time.year],[f.y,25,d3.time.year,d3.time.year],[f.y,50,d3.time.year,d3.time.year],[f.y,100,d3.time.year,d3.time.year],[f.y,100,d3.time.year,d3.time.year]];return q}(); binnedData=function(){function a(d){return Math.pow(2,d)*f}function b(d,c){for(var a=[],g=d.length,b=0,l=0;l<c.length;l++)for(;;){if(b>=g){a.push(c[l]);break}if(d[b].ms>c[l].ms){a.push(c[l]);break}else if(d[b].ms===c[l].ms){isNaN(d[b].val)&&(d[b].val=c[l].val);break}else b++}return d.concat(a)}function e(d,c){var g=a(c)*shmotg.MAX_NUMBER_OF_ITEMS_PER_ARRAY;return Math.floor(d/g)*g}function k(d,c,a){var g=l.binContainerSize(a);d=e(d,a);return _.range(d,c,g)}function h(d,c){return _.groupBy(d,function(d){return e(d.ms, c)})}function m(d,c){for(var b=c+1;b<shmotg.MAX_NUMBER_OF_BIN_LEVELS;b++)for(var e=0;e<g.keys.length;e++){var k=g.keys[e],m;var h=g;m=b-1;var q=k,r=g[k].func,s=d,y=[];if(h[0===m?"rawData":q].levels[m]){var z=n(h,m,q,s),I=[];"q1"===q?I=n(h,m,"q3",s):"q3"===q&&(I=n(h,m,"q1",s));for(h=0;h<z.length;h+=2){var s=0===z[h].ms%(Math.pow(2,m+1)*f),K=z.length>h+1,O=K?z[h+1].ms-z[h].ms===a(m):!0;s&&K&&O?z[h+1]&&(s=z[h].ms,"q1"===q||"q3"===q?y.push({val:r(z[h].val,z[h+1].val,I[h].val,I[h+1].val),ms:s}):y.push({val:r(z[h].val, z[h+1].val),ms:s})):h-=1}}m=y;0!==m.length&&l.addData(m,k,b)}}function n(d,c,a,g){g=[e(g[0],c+1),e(g[1],c+1)+l.binContainerSize(c+1)];if(!g[0]||!g[1])return[];g=k(g[0],g[1],c);var b=[],f;for(f in g)d[0===c?"rawData":a].levels[c][g[f]]&&(b=b.concat(d[0===c?"rawData":a].levels[c][g[f]]));return b}function r(d){return d3.sum(d)/d.length}function q(d,c){var a=b(d,c);a.sort(function(c,d){return c.ms-d.ms});return a}function s(d,c){return _.filter(d,function(d){return!_.contains(c,d)})}var f=5,g={keys:["average", "maxes","mins","q1","q3"],rawData:{levels:[]},average:{func:function(d,c){return(d+c)/2},levels:[]},maxes:{func:function(d,c){return d3.max([d,c])},levels:[]},mins:{func:function(d,c){return d3.min([d,c])},levels:[]},q1:{func:function(d,c,a,g){c=[d,c,a,g].slice();d=d3.min(c);c.splice(c.indexOf(d),1);c=d3.min(c);return r([d,c])},levels:[]},q3:{func:function(d,c,a,g){c=[d,c,a,g].slice();d=d3.max(c);c.splice(c.indexOf(d),1);c=d3.max(c);return r([d,c])},levels:[]},quartiles:{levels:[]},missing:{levels:[]}, missingBox:{levels:[]},loadingBox:{levels:[]}},l=function(){};l.addData=function(d,c,a){d=h(d,a);for(var b in d)d.hasOwnProperty(b)&&(g[c].levels[a]||(g[c].levels[a]={}),g[c].levels[a][b]||(g[c].levels[a][b]=[]),g[c].levels[a][b]=q(g[c].levels[a][b],d[b]))};l.addRawData=function(d,c){var a=d3.extent(d,function(c){return c.ms});l.addData(d,"rawData",0);c||m(a,0);return l};l.replaceRawData=function(d,c){var a=d3.extent(d,function(c){return c.ms});g.rawData.levels[0]||(g.rawData.levels[0]=[]);g.rawData.levels[0]= d;c||m(a,0);return l};l.addBinnedData=function(d,c,a){for(var b=[],e=[],f=["average","q1","q3","mins","maxes"],k=function(c){return c.ms},h=0;h<f.length;h++)if(d[f[h]]&&d[f[h]].levels&&d[f[h]].levels[c]){var n=d3.extent(d[f[h]].levels[c],k);b.push(n[0]);e.push(n[1])}b=[d3.min(b),d3.max(e)];for(e=0;e<g.keys.length;e++)f=g.keys[e],l.addData(d[f].levels[c],f,c);a||m(b,c);return l};l.replaceBinnedData=function(d,c,a){for(var b=d3.extent(d.average.levels[c],function(c){return c.ms}),e=0;e<g.keys.length;e++){var f= g.keys[e];g[f].levels[c]||(g[f].levels[c]=[]);d[f].levels&&(g[f].levels[c]=d[f].levels[c])}a||m(b,0);return l};l.replaceAllData=function(d){g=d};l.haveDataInRange=function(d,c){var g=l.getDateRange([0===c?"rawData":"average"],c,d);if(0===g.length)return!1;var b=g[0].ms;if(b>d[0]+a(c))return!1;b=Math.floor((d[1]-b)/a(c));return g.length>=b};l.missingBins=function(d,c,g){var b;b=0===c?"rawData":"average";var e=Math.floor(d[0]/(Math.pow(2,c)*f)),k=Math.floor(d[1]/(Math.pow(2,c)*f)),e=[e*Math.pow(2,c)* f,(k+1)*Math.pow(2,c)*f];b=l.getDateRange([b],c,e);if(0===b.length)return g?[d[0]]:[d];d=_.range(e[0],e[1],a(c));d.forEach(function(d){Math.pow(2,c)});d=s(d,_.pluck(b,"ms"));d.total=b.length;if(g)return d;var h=[];_.each(d,function(d){h.push([d,d+a(c)])});return h};l.getExtentsForLvlKeysRange=function(d,c,a){return d3.extent(l.getDateRange(c,d,a),function(c){return c.val})};l.getMin=function(d){for(var c=999999,a="",b=function(c){return c.val},a=0===d?"rawData":"average",l=0;l<g[a].levels[d].length;l++)c= Math.min(d3.min(g[a].levels[d][l],b),c);return c};l.getMax=function(d){for(var c=-999999,a="",b=function(c){return c.val},a=0===d?"rawData":"average",l=0;l<g[a].levels[d].length;l++)c=Math.max(d3.max(g[a].levels[d][l],b),c);return c};l.getMinMS=function(d){var c="",c=0===d?"rawData":"average",a=Object.keys(g[c].levels[d]);return d3.min(g[c].levels[d][Math.min.apply(null,a)],function(c){return c.ms})};l.getMaxMS=function(d){var c="",c=0===d?"rawData":"average",a=Object.keys(g[c].levels[d]);return d3.max(g[c].levels[d][Math.max.apply(null, a)],function(c){return c.ms})};l.getColor=function(d){return g[d].color};l.getDash=function(d){return g[d].dash};l.getOpacity=function(d){return g[d].opacity};l.getAllInRange=function(d,c){for(var a=["average","q1","q3","mins","maxes"],g={},b=0;b<a.length;b++)g[a[b]]={},g[a[b]].levels=[],g[a[b]].levels[d]=l.getDateRange([a[b]],d,c);return g};l.getDateRangeWithMissingValues=function(d,c,a,g){var b=l.missingBins(a,c,!0),e=l.binSize(c),b=b.map(function(c){return{ms:c,val:NaN}});d=q(b,l.getDateRange([d], c,[a[0]-e,a[1]+e]));if(g)for(g=d.length,c=1;c<g;c++)isNaN(d[c].val)&&(d.splice(c,0,{ms:d[c].ms,val:d[c-1].val}),c++,g++);return d};l.getDateRange=function(d,c,a){for(var b=[],l=function(d){g[0===c?"rawData":h]&&g[0===c?"rawData":h].levels[c]&&(b=b.concat(_.filter(g[0===c?"rawData":h].levels[c][d],function(c){return c.ms<=a[1]&&c.ms>=a[0]})))},e=k(a[0],a[1],c),f=0;f<d.length;f++){var h=d[f];_.each(e,l)}return b=b.sort(function(c,d){return c.ms-d.ms})};l.removeAllLevelsBelow=function(d){for(var c=0;c< d;c++)for(var a=0;a<g.keys.length;a++)g[g.keys[a]].levels[c]={};0<d&&(g.rawData.levels[0]={})};l.importDataFromAnotherBinnedDataObject=function(d){for(var c=0;c<d.keys.length;c++)for(var a=d.keys[c],l=0;l<shmotg.MAX_NUMBER_OF_BIN_LEVELS;l++)if(d[a].levels[l])for(var e=0;e<d[a].levels[l].length;e++)g[a].levels[l]||(g[a].levels[l]={}),g[a].levels[l].hasOwnProperty(e)?g[a].levels[l][e]=b(g[a].levels[l][e],d[a].levels[l][e]):g[a].levels[l][e]=d[a].levels[l][e]};l.doToEachContainerInRange=function(a,c, b){k(a[0],a[1],c).forEach(function(c){b(c)})};l.binSize=function(a){return Math.pow(2,a)*f};l.oneSample=function(a){if(!arguments.length)return f;f=a;return l};l.binContainerSize=function(a){return l.binSize(a)*shmotg.MAX_NUMBER_OF_ITEMS_PER_ARRAY};l.getSurroundingBinContainers=function(a,c,b){return k(a,c,b)};l.getSurroundingBins=function(a,c,b){var g=Math.pow(2,b)*f;a=e(a,b);return _.range(a,c,g)};l.getBinContainerForMSAtLevel=function(a,c){return e(a,c)};l.getKeys=function(){return g.keys.slice(0)}; l.bd=function(){return g};l.combineAndSortArraysOfDateValObjects=function(a,c){return q(a,c)};l.getChildBins=function(a,c){var b=[a],g=l.binSize(c-1);0===a%(Math.pow(2,c)*f)?b.push(a+g):b.push(a-g);return b};l.toString=function(){return JSON.stringify(g)};l.rebinAll=function(a,c){m(a,c)};return l}; multiData=function(a){function b(a){return Math.pow(2,a)*q}function e(a,b){for(var d=[],c=a.length,e=0,f=0;f<b.length;f++)for(;;){if(e>=c){d.push(b[f]);break}if(a[e].ms>b[f].ms){d.push(b[f]);break}else if(a[e].ms===b[f].ms){isNaN(a[e].val)&&(a[e].val=b[f].val);break}else e++}return a.concat(d)}function k(a,l){var d=b(l)*shmotg.MAX_NUMBER_OF_ITEMS_PER_ARRAY;return Math.floor(a/d)*d}function h(a,b,d){var c=f.binContainerSize(d);a=k(a,d);return _.range(a,b,c)}function m(a,b){return _.groupBy(a,function(a){return k(a.ms, b)})}function n(a,b){var d=e(a,b);d.sort(function(a,d){return a.ms-d.ms});return d}function r(a,b){return _.filter(a,function(a){return!_.contains(b,a)})}var q=5,s=[],f=function(){};f.addData=function(a,b,d){a=m(a,d);for(var c in a)a.hasOwnProperty(c)&&(bd[b].levels[d]||(bd[b].levels[d]={}),bd[b].levels[d][c]||(bd[b].levels[d][c]=[]),bd[b].levels[d][c]=n(bd[b].levels[d][c],a[c]))};f.addRawData=function(a,b){return f};f.replaceRawData=function(a,b){d3.extent(a,function(a){return a.ms});bd.rawData.levels[0]|| (bd.rawData.levels[0]=[]);bd.rawData.levels[0]=a;return f};f.addBinnedData=function(a,b,d){return f};f.replaceBinnedData=function(a,b,d){d3.extent(a.average.levels[b],function(a){return a.ms});for(d=0;d<bd.keys.length;d++){var c=bd.keys[d];bd[c].levels[b]||(bd[c].levels[b]=[]);a[c].levels&&(bd[c].levels[b]=a[c].levels[b])}return f};f.replaceAllData=function(a){bd=a};f.haveDataInRange=function(a,e,d){d=f.getDateRange([0===e?"rawData":"average"],e,a,d);if(0===d.length)return!1;var c=d[0].ms;if(c>a[0]+ b(e))return!1;a=Math.floor((a[1]-c)/b(e));return d.length>=a};f.missingBins=function(a,e,d){var c;c=0===e?"rawData":"average";var h=Math.floor(a[0]/(Math.pow(2,e)*q)),k=Math.floor(a[1]/(Math.pow(2,e)*q)),h=[h*Math.pow(2,e)*q,(k+1)*Math.pow(2,e)*q];c=f.getDateRange([c],e,h);if(0===c.length)return d?[a[0]]:[a];a=_.range(h[0],h[1],b(e));a.forEach(function(a){Math.pow(2,e)});a=r(a,_.pluck(c,"ms"));a.total=c.length;if(d)return a;var m=[];_.each(a,function(a){m.push([a,a+b(e)])});return m};f.getMin=function(a){for(var b= 999999,d="",c=function(a){return a.val},d=0===a?"rawData":"average",e=0;e<bd[d].levels[a].length;e++)b=Math.min(d3.min(bd[d].levels[a][e],c),b);return b};f.getMax=function(a){for(var b=-999999,d="",c=function(a){return a.val},d=0===a?"rawData":"average",e=0;e<bd[d].levels[a].length;e++)b=Math.max(d3.max(bd[d].levels[a][e],c),b);return b};f.getMinMS=function(a){var b="",b=0===a?"rawData":"average",d=Object.keys(bd[b].levels[a]);return d3.min(bd[b].levels[a][Math.min.apply(null,d)],function(a){return a.ms})}; f.getMaxMS=function(a){var b="",b=0===a?"rawData":"average",d=Object.keys(bd[b].levels[a]);return d3.max(bd[b].levels[a][Math.max.apply(null,d)],function(a){return a.ms})};f.getColor=function(a){return s[0].bd()[a].color};f.getDash=function(a){return s[0].bd()[a].dash};f.getOpacity=function(a){return s[0].bd()[a].opacity};f.getAllInRange=function(a,b){for(var d=["average","q1","q3","mins","maxes"],c={},e=0;e<d.length;e++)c[d[e]]={},c[d[e]].levels=[],c[d[e]].levels[a]=f.getDateRange([d[e]],a,b);return c}; f.getDateRangeWithMissingValues=function(a,b,d,c,e){var h=[];_.each(s,function(k){h.push(f.normalizeArrayToDomainOfKeys(k,k.getDateRangeWithMissingValues(a,b,d,c),e,d,b))});return f.multiplyArraysOfDateValObjects(h)};f.normalizeArrayToDomainOfKeys=function(a,b,d,c,e){a=a.getExtentsForLvlKeysRange(e,d,c);return f.normalizeArrayOfMSValues(b,a)};f.normalizeArrayOfMSValues=function(a,b){var d=d3.scale.linear().range([1E-4,1]);b?d.domain(b):d.domain(d3.extent(a,function(a){return a.val}));return _.map(a, function(a){return{ms:a.ms,val:d(a.val)}})};f.multiplyArraysOfDateValObjects=function(b){var e=[];_.each(b,function(a){e=_.union(e,_.pluck(a,"ms"))});var e=e.sort(function(a,b){return a-b}),d=[];_.each(e,function(c){var e=[];_.each(b,function(a){a=_.find(a,function(a){return a.ms===c});void 0===a||isNaN(a.ms)?e.push(null):e.push(a.val)});if(!_.contains(e,null)){var f=d3.scale.linear().domain([-1,1]).range([0,1]);d.push({ms:c,val:_.reduce(e,function(c,b){return a?c*b:f(c-b)},1)})}});return d};f.getDateRange= function(a,b,d,c){var e=[];_.each(s,function(h){e.push(f.normalizeArrayToDomainOfKeys(h,h.getDateRange(a,b,d),c,d,b))});return f.multiplyArraysOfDateValObjects(e)};f.removeAllLevelsBelow=function(a){for(var b=0;b<a;b++)for(var d=0;d<bd.keys.length;d++)bd[bd.keys[d]].levels[b]={};0<a&&(bd.rawData.levels[0]={})};f.importDataFromAnotherBinnedDataObject=function(a){for(var b=0;b<a.keys.length;b++)for(var d=a.keys[b],c=0;c<shmotg.MAX_NUMBER_OF_BIN_LEVELS;c++)if(a[d].levels[c])for(var f=0;f<a[d].levels[c].length;f++)bd[d].levels[c]|| (bd[d].levels[c]={}),bd[d].levels[c].hasOwnProperty(f)?bd[d].levels[c][f]=e(bd[d].levels[c][f],a[d].levels[c][f]):bd[d].levels[c][f]=a[d].levels[c][f]};f.doToEachContainerInRange=function(a,b,d){h(a[0],a[1],b).forEach(function(a){d(a)})};f.binSize=function(a){return Math.pow(2,a)*q};f.oneSample=function(a){if(!arguments.length)return q;q=a;return f};f.binContainerSize=function(a){return f.binSize(a)*shmotg.MAX_NUMBER_OF_ITEMS_PER_ARRAY};f.getSurroundingBinContainers=function(a,b,d){return h(a,b,d)}; f.getSurroundingBins=function(a,b,d){var c=Math.pow(2,d)*q;a=k(a,d);return _.range(a,b,c)};f.getBinContainerForMSAtLevel=function(a,b){return k(a,b)};f.getKeys=function(){return s[0].bd().keys.slice(0)};f.bd=function(){return bd};f.combineAndSortArraysOfDateValObjects=function(a,b){return n(a,b)};f.getChildBins=function(a,b){var d=[a],c=f.binSize(b-1);0===a%(Math.pow(2,b)*q)?d.push(a+c):d.push(a-c);return d};f.toString=function(){return JSON.stringify(bd)};f.rebinAll=function(a,b){};f.addParentData= function(a){s.push(a)};return f}; (function(){slider=function(){function a(){var a=Math.floor((D+e/2-J)/e);q(d3.transform(f.attr("transform")).translate[1],a,K);H!==a&&d3.selectAll(".slider_boxes").classed("highlighted",function(b,c){return c==a});H=a}function b(b,q){s=b;K=q;b.each(function(b,q){var s=d3.select(this);d=d?d:s.append("svg");d.attr("width",k).attr("height",h);M&&(c=c?c:d.insert("defs").append("clipPath").attr("id","clip"+n).append("rect"),c.attr("width",e).attr("transform","translate("+r+", 0)").attr("height",h));M&& (f=f?f:d.append("g").attr("id","slide_container"+n).attr("clip-path","url(#clip"+n+")").append("g").attr("id","slide_region"+n).attr("class","slide_region"),slide_dat_applied=f.selectAll("g").data(d3.range(m)),slide_enter=slide_dat_applied.enter().append("g"),slide_enter.append("path").attr("d",B).on("mouseover",$).on("mouseout",aa).on("mousedown",u).on("click",ba).attr("class","slider_boxes"),slide_enter.append("text").attr("text-anchor","middle").attr("dominant-baseline","middle").attr("x",function(a){return r+ e/2}).attr("y",function(a,b){return(b+1)*e-e/2}).text(function(a,b){return b}).attr("class","slider_text"),slide_dat_applied.exit().remove());if(M){w=w?w:d.append("g").attr("id","surrounding_lines"+n);var s=[{x:0,y:0},{x:e+2*r,y:0}],P=[{x:0,y:h},{x:e+2*r,y:h}],L=[{x:r,y:0},{x:r,y:h}],C=[{x:e+r,y:0},{x:e+r,y:h}];x=x?x:d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear");I=I?I:w.append("path").attr("class","slider_outlines");I.attr("d",x(s));E=E?E:w.append("path").attr("class", "slider_outlines");E.attr("d",x(P));y=y?y:w.append("path").attr("class","slider_outlines");y.attr("d",x(L));z=z?z:w.append("path").attr("class","slider_outlines");z.attr("d",x(C))}g=g?g:d.append("g").attr("id","handle_region"+n).attr("class","handle_region");g.attr("transform","translate(0,"+D+")");s=Math.max(0,e/2);P=Math.min(h,e/2);L=e/2;N=N?N:g.append("clipPath").attr("id","clip-handle"+n).append("path").attr("d",U(s,P,L));t=t?t:g.append("path").attr("d",U(s,P,L)).attr("id","handle"+n).attr("clip-path", "url(#clip-handle"+n+")").attr("class","handle");l=l?l:g.append("g").attr("id","dragLines"+n);l.selectAll("path").data([0,1,2]).enter().append("path").attr("d",T).attr("class","dragLines").attr("transform","translate("+(r+e+L)+",0)");M&&(f.call(O),g.call(V));K&&a();M=!1});d3.timer.flush()}var e=30,k=90,h=140,m=12,n="_id",r=0,q=function(){},s,f,g,l,d,c,x,N,t,D=0,J=0,H=-1,w,E,y,z,I,K,O=d3.behavior.drag().origin(Object).on("drag",function(){var b=d3.event.dy,c=f,d=d3.transform(c.attr("transform")).translate, g=d[0],b=Math.max(-m*e+h,Math.min(0,d[1]+b));c.attr("transform","translate("+g+","+b+")");a()}),V=d3.behavior.drag().origin(Object).on("drag",function(b){var c=d3.event.dy;b=g;var d=d3.transform(b.attr("transform")).translate,f=d[0];D=c=Math.min(h-e,Math.max(0,d[1]+c));b.attr("transform","translate("+f+","+c+")");a()}),M=!0,$=function(){d3.select(this).classed("hover",!0);d3.select(this).classed("mousedown",!1)},aa=function(){d3.select(this).classed("hover",!1);d3.select(this).classed("mousedown", !1)},u=function(a){d3.select(this).classed("hover",!1);d3.select(this).classed("mousedown",!0);a.preventDefault&&a.preventDefault();a.returnValue=!1},ba=function(){d3.event.defaultPrevented||(d3.select(this).classed("hover",!1),d3.select(this).classed("mousedown",!1),b.handlePosition(this.__data__*e+J).update(!0))},B=function(a,b){dat=[{x:r+e,y:b*e},{x:r,y:b*e},{x:r,y:(b+1)*e},{x:r+e,y:(b+1)*e}];return d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear")(dat)}, U=function(a,b,c){dat=[{x:e+r,y:a},{x:e+r+c,y:0},{x:e+r+c+e,y:0},{x:e+r+c+e,y:0+e},{x:e+r+c,y:0+e},{x:e+r,y:b}];return function(){return d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear")(dat)}},T=function(a,b){dat=[{x:1/3*e,y:(b+2)/6*e},{x:2/3*e,y:(b+2)/6*e}];return d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear")(dat)};b.width=function(a){if(!arguments.length)return k;k=a;return b};b.height=function(a){if(!arguments.length)return h; h=a;return b};b.boxSize=function(a){if(!arguments.length)return e;e=a;return b};b.numberOfLevels=function(a){if(!arguments.length)return m;m=a;return b};b.changeCallBack=function(a){if(!arguments.length)return q;q=a;return b};b.pastExtents=function(a){return a<h-e*m?!0:0<a?!0:!1};b.scrollPosition=function(a){if(!arguments.length)return J;if(a===J)return b;J=Math.min(0,Math.max(h-e*m,a));var c=d3.select("#slide_region"+n),d=d3.transform(c.attr("transform")).translate[0];c.attr("transform","translate("+ d+","+J+")");return b};b.handlePosition=function(a){if(!arguments.length)return D;D=Math.max(0,Math.min(h-e,a));return b};b.highlightSliderElement=function(){a()};b.update=function(a){a&&b(s,!0);b(s)};return b}})();String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}; var justItself=function(a){return a},justValue=function(a){return a.value},justval=function(a){return a.val},notNaNVal=function(a){return!isNaN(a.val)},notNaNValFirst=function(a){return notNaNVal(a[0])},isNaNVal=function(a){return isNaN(a.val)};function addBValuesToA(a,b){var e,k=b.length;for(e=0;e<k;e+=1)a.push(b[e])} var msDifference=function(a,b){return a.ms-b.ms},generateLoadingBoxArray=function(a,b,e,k){e=k.getDateRangeWithMissingValues("average",a,b,!1,e);var h=[],m=0,n=[];1>=e.length?(n.push({val:NaN,ms:b[0]}),n.push({val:NaN,ms:b[1]})):n=_.map(e,function(b){var e={};e.val=b.val;e.ms=b.ms;isNaN(e.val)&&(b=k.binSize(a),k.getChildBins(e.ms,a),h.push({val:e.val,ms:e.ms+b-1}));m++;return e});n.sort(msDifference);return n=k.combineAndSortArraysOfDateValObjects(n,h)},generateMissingArray=function(a,b,e,k){var h= k.getDateRangeWithMissingValues("average",a,b,!1,e),m=[],n=0,r=_.map(h,function(b){tmp={};tmp.val=b.val;tmp.ms=b.ms;if(isNaN(tmp.val)){b=k.binSize(a);var f=k.getChildBins(tmp.ms,a);tmp.val=averageOfRange(k.getDateRangeWithMissingValues("average",a-1,f,!1,e));h[n-1]&&!isNaN(h[n-1].val)&&m.push({val:h[n-1].val,ms:h[n-1].ms});h[n+1]&&!isNaN(h[n+1].val)?m.push({val:h[n+1].val,ms:h[n+1].ms}):m.push({val:tmp.val,ms:tmp.ms+b-1})}n++;return tmp});r.sort(msDifference);var r=k.combineAndSortArraysOfDateValObjects(r, m),q=[],s=0,f=[];1>=h.length?(f.push({val:NaN,ms:b[0]}),f.push({val:NaN,ms:b[1]})):f=_.map(h,function(b){tmp={};tmp.val=b.val;tmp.ms=b.ms;isNaN(tmp.val)&&(b=k.binSize(a),k.getChildBins(tmp.ms,a),q.push({val:tmp.val,ms:tmp.ms+b-1}));s++;return tmp});f.sort(msDifference);f=k.combineAndSortArraysOfDateValObjects(f,q);return[r,f]},averageOfRange=function(a){for(var b=0,e=0,k=0;k<a.length;k++)isNaN(a[k].val)||(b+=a[k].val,e++);return 0===e?NaN:b/e},isWithinRange=function(a,b){return a[0]>=b[0]&&a[1]<= b[1]};function getScaleValue(a){return(a.range()[1]-a.range()[0])/(a.domain()[1]-a.domain()[0])}function transformScale(a,b,e){getScaleValue(a);var k=getScaleValue(a);a=e.left+k*(b.domain()[0]-a.domain()[0]);e=e.top;b=k/getScaleValue(b);return"translate("+a+","+e+")scale("+b+",1)"}function generateKey(a){return a.key+a.which+a.interpolate} function drawElements(a,b,e,k,h,m,n,r,q,s,f,g,l,d,c,x,N,t){a=b.selectAll("."+N+e).data(a,generateKey);r?a.attr("transform",transformScale(q,c,d)).attr("d",function(a,b){return g[a.key]}).transition().ease(s).duration(f).attr("transform",transformScale(n,c,d)):a.attr("opacity",function(a){return l.getOpacity(a.key)}).attr("d",function(a,b){return g[a.key]?g[a.key]:"M -1000 -1000 L -1000 -1000"}).attr("transform",transformScale(n,c,d));a.enter().append("path").attr("class",function(a){return N+e+" "+ a.key}).attr("d",function(a,b){return g[a.key]});r?a.attr("transform",transformScale(q,c,d)).attr("opacity",0).transition().ease(s).duration(f).attr("transform",transformScale(n,c,d)).attr("opacity",function(a){return l.getOpacity(a.key)}):a.attr("transform",transformScale(n,c,d)).attr("opacity",function(a){return l.getOpacity(a.key)});a=r?a.exit().transition().ease(s).duration(f):a.exit();a.attr("transform",transformScale(n,q,d)).attr("opacity",0).remove()} function maxBinRenderSize(){return document.getElementById("renderdepth").value} var makeDataObjectForKeyFanciness=function(a,b,e,k){var h=[],m=0;a.getKeys();for(var n in b)for(a=b[n],m=0;m<shmotg.MAX_NUMBER_OF_BIN_LEVELS;m++)e===m&&h.push({key:a,which:m,interpolate:k});return h},makeQuartileObjectForKeyFanciness=function(a,b,e){var k=[],h=0;if(-1<a.indexOf("quartiles"))for(h=0;h<shmotg.MAX_NUMBER_OF_BIN_LEVELS;h++)b===h&&k.push({key:"quartiles",which:h,interpolate:e});-1<a.indexOf("missingBox")&&k.push({key:"missingBox",which:0,interpolate:e});return k}; function goToLevel(a,b){var e=maxBinRenderSize(),k=getScaleValue(a)*b,e=Math.log(e/k)/Math.log(2),e=Math.floor(e),e=d3.max([0,e]),e=d3.min([shmotg.MAX_NUMBER_OF_BIN_LEVELS-1,e]);d3.select("#current_level").text(e);return e} var times=msToCentury.times,timeContextFormatSpecifier=[{fun:function(a,b){return b-a<2*times.y},formIf:"%Y",formIfNot:""},{fun:function(a,b){return b-a<2*times.mo},formIf:" %b",formIfNot:""},{fun:function(a,b){return b-a<2*times.d},formIf:" %a %d",formIfNot:""},{fun:function(a,b){return b-a<2*times.h},formIf:" %H",formIfNot:""},{fun:function(a,b){return b-a<2*times.m},formIf:":%M",formIfNot:"h"},{fun:function(a,b){return b-a<2*times.s},formIf:":%Ss",formIfNot:""}]; function dt(a){var b=new Date;b.setTime(a);return b} var getTimeContextString=function(a,b){if(!b)return[];var e="",k=a.domain()[0],h=a.domain()[1],m=!1;return e=d3.time.format(_.reduce(timeContextFormatSpecifier,function(a,b){if(m)return a;if(b.fun(k,h))return a+b.formIf;m=!0;return a+b.formIfNot},""))(dt(k))},binnedLineChart=function(a,b,e,k,h,m,n,r){function q(a){return v.getOpacity(a.key)}function s(a,b,c,d,e,f,g,h,k,m,l,n,r,p,s,t,u,v){a=b.selectAll("."+u+c).data(a,generateKey);h?a.attr("transform",transformScale(k,s,p)).transition().ease(m).duration(l).attr("transform", transformScale(g,s,p)):a.attr("opacity",q).attr("transform",transformScale(g,s,p))}var f=[],g=[],l=!0,d=1,c=e,x=k,N=1,t={top:10,right:27,bottom:25,left:120},D=150-t.top-t.bottom,J=document.getElementById("chartContainer").offsetWidth,H=J-t.left-t.right,w=m?m:0,E=["average","maxes","mins"],y=["linear"],z=!0,I,K,O,V,M,$,aa,u,ba,B,U,T=d3.scale.linear(),P,L,Q,Y,Z,ea,S=!1,C=!0,da=!1,v=binnedData();if(h)v.oneSample(h);var A=[],F=[],W=[],fa=[],R=!1,G={rawData:"",rawDataRanges:[],average:"",averageRanges:[], maxes:"",maxesRanges:[],mins:"",minsRanges:[],q1:"",q1Ranges:[],q2:"",q2Ranges:[],q3:"",q3Ranges:[],quartiles:"",quartilesRanges:[],missing:"",missingRanges:[],missingBox:"",missingBoxRanges:[],loadingBox:"",loadingBoxRanges:[]},ia=function(){L||(aa||(aa=d3.svg.axis().ticks(5).tickSubdivide(!0).tickSize(H,0,0).orient("left")),aa.scale(B).tickSize(H,0,0));Q=d3.select(this);C&&(ea.attr("width",H),Q.attr("width",H+t.left+t.right).attr("height",D+t.top+t.bottom));I||(I=Q.insert("defs").append("clipPath").attr("id", "clip"+c+x).append("rect"));C&&I.attr("width",H).attr("transform","translate("+t.left+", "+t.top+")").attr("height",D);Y=Y?Y:Q.append("g").attr("id","paths"+c+x+"posArea");C&&Y.attr("clip-path","url(#clip"+c+x+")").attr("class","posArea").attr("height",D);var a=makeQuartileObjectForKeyFanciness(A,w,y,!0);R||C?drawElements(a,Y,c+x,function(a){return v.getColor(a.key)},function(a){return"rgba(0,0,0,0)"},function(a){return v.getDash(a.key)},u,S,T,"cubic-in-out",500,G,v,t,X,d,"posArea",R||C):s(a,Y,c+ x,function(a){return v.getColor(a.key)},function(a){return"rgba(0,0,0,0)"},function(a){return v.getDash(a.key)},u,S,T,"cubic-in-out",500,G,v,t,X,d,"posArea",R||C);Z=Z?Z:Q.append("g").attr("id","paths"+c+x+"posPath");Z.attr("clip-path","url(#clip"+c+x+")").attr("class","posPath").attr("height",D);a=makeDataObjectForKeyFanciness(v,0===w?["average"]:E,w,y);-1<A.indexOf("loadingBox")&&a.push({key:"loadingBox",which:0,interpolate:y});R||C?drawElements(a,Z,c+x,function(a){console.log(n);return n?"#F0F": "rgba(0,0,0,0)"},function(a){return n?"rgba(0,0,0,0)":0===w?"#4D4D4D":v.getColor(a.key)},function(a){return v.getDash(a.key)},u,S,T,"cubic-in-out",500,G,v,t,X,d,"posPath",R||C):s(a,Z,c+x,function(a){console.log(n);return n?"#F0F":"rgba(0,0,0,0)"},function(a){return n?"rgba(0,0,0,0)":0===w?"#4D4D4D":v.getColor(a.key)},function(a){return v.getDash(a.key)},u,S,T,"cubic-in-out",500,G,v,t,X,d,"posPath",R||C);V||(V=d3.svg.axis().tickFormat(msToCentury.TickFormat).orient("bottom"));V.scale(u).tickValues(msToCentury.TickValues(u, H));M||(M=d3.svg.axis().tickFormat(null).scale(u).orient("bottom"));M.scale(u).tickValues(msToCentury.SubTickValues(u,H));K||(K=Q.append("g").attr("class","x axis"));C&&K.attr("transform","translate("+t.left+", "+(t.top+D)+")");O||(O=Q.append("g").attr("class","x axis minor"));C&&O.attr("transform","translate("+t.left+", "+(t.top+D)+")");S?(K.transition().duration(500).ease("cubic-in-out").call(V),O.transition().duration(500).ease("cubic-in-out").call(M)):(K.call(V),O.call(M));$||($=Q.append("g").attr("class", "y axis"));C&&$.attr("transform","translate("+(H+t.left)+", "+t.top+")");$.call(aa);P||(P=Q.append("g"));var a=P.selectAll(".sensor_time_context").data([getTimeContextString(u,z)]),b=P.selectAll(".sensor_title").data([c.capitalize()+" "+x]);a.enter().append("text").attr("class","sensor_time_context");b.enter().append("text").attr("class","sensor_title");a.text(justItself);C&&a.attr("x",t.left-5).attr("y",shmotg.TIME_CONTEXT_VERTICAL_EACH);b.text(justItself);C&&b.attr("x",t.left+H).attr("y",shmotg.TIME_CONTEXT_VERTICAL_EACH); a.exit().remove();b.exit().remove()},ga=function(a){return B(a.val)},ja=function(a){return B(a[0].val)},ka=function(a){return B(a[1].val)},ca=function(a){ha(X,u);return(a.ms-X.domain()[0])*getScaleValue(X)},la=function(a){return ca(a[0])},ma=function(a,b,c){var d=!1;return function(a,b,c){a=d3.select("#"+a);if(!a)return b;d=d?d:a.append("linearGradient");c=d.attr("id",b).attr("gradientUnits","userSpaceOnUse").attr("x1",u.range()[0]).attr("y1",0).attr("x2",u.range()[1]).attr("y2",0).selectAll("stop").data(c); c.enter().append("stop");c.attr("offset",function(a,b){var c=a.ms,d=u,e=d.range()[0],d=d.range()[1];return(u(c)-e)/(d-e)*100+"%"}).attr("stop-opacity",function(a){return 1-parseFloat(a.val)}).attr("stop-color","black");c.exit().remove();return b}}(),ha=function(a,b){a.domain()[0]=b.domain()[0];a.domain()[1]=b.domain()[1];a.range()[0]=b.range()[0];a.range()[1]=b.range()[1]},X=d3.scale.linear();v.addRawData(a);var p=function(a){ea=a;H=J-t.left-t.right;u||(u=d3.scale.linear().domain([0,100]));ba||(ba= [0,0]);ba[1]=H;u.range(ba);B||(B=d3.scale.linear());U||(U=[0,0]);U[0]=D;B.range(U);A.length=0;addBValuesToA(A,E);-1!==E.indexOf("quartiles")&&(-1===E.indexOf("q3")&&A.push("q3"),-1===E.indexOf("q1")&&A.push("q1"));-1!==E.indexOf("missing")&&A.unshift("missingBox");0===w&&(A.length=0,A.push("average"));A.push("loadingBox");var d=u.domain()[1]-u.domain()[0];F[0]=u.domain()[0]-d;F[1]=u.domain()[1]+d;R=!1;W.length=0;for(var e in A){var d=A[e],f=0.1*(G[d+"Ranges"][1]-G[d+"Ranges"][0]);fa[0]=G[d+"Ranges"][0]+ f;fa[1]=G[d+"Ranges"][1]-f;if(!isWithinRange(u.domain(),fa)||C){R=!0;0===W.length&&(f=v.binSize(w),W=d3.extent(v.getDateRange(A,w,[F[0]-f,F[1]+f],A),justval));L||da||(r?B.domain([0,1]):B.domain([W[0]?W[0]:B.domain()[0],W[1]?W[1]:B.domain()[1]]));if("quartiles"===d){if(n)continue;var f=v.getDateRangeWithMissingValues("q1",w,F,"step-after"===y,A),g=v.getDateRangeWithMissingValues("q3",w,F,"step-after"===y,A);G.quartiles=d3.svg.area().defined(notNaNValFirst).x(la).y0(ja).y1(ka).interpolate(y)(_.zip(f, g))}else"loadingBox"===d?(f=generateLoadingBoxArray(w,F,A,v),G.loadingBox=d3.svg.line().defined(isNaNVal).x(ca).y(B.range()[0]).interpolate(y)(f)):"missing"!==d||n?(f=[],n&&"average"!==d||(n&&"average"===d?(f=v.getDateRange([d],w,F,!1,A),G.average=d3.svg.area().defined(notNaNVal).x(ca).y0(B(0)).y1(B(1)).interpolate(y)(f),ma("cloudcover1","cloudgradient",f)):(f=v.getDateRangeWithMissingValues(d,w,F,"step-after"===y,A),G[d]=d3.svg.line().defined(notNaNVal).x(ca).y(ga).interpolate(y)(f)))):(f=generateMissingArray(w, F,A,v),G.missingBox=d3.svg.area().defined(isNaNVal).x(ca).y0(B.range()[0]).y1(B.range()[1]).interpolate(y)(f[1]),G[d]=d3.svg.line().defined(notNaNVal).x(ca).y(ga).interpolate(y)(f[0]));G[d+"Ranges"]=[F[0],F[1]]}}!R||da||v.haveDataInRange(F,w,A)||(e={sensorNumber:x,sensorType:c,ms_start:F[0],ms_end:F[1],bin_level:w},da=!0,void 0===b||b(e)||(da=!1));a.each(ia);C=S=!1};p.milliSecondsPerSample=function(a){if(!arguments.length)return N;N=a;return p};p.containerWidth=function(a){if(!arguments.length)return J; J!==a&&p.reRenderTheNextTime(!0);J=a;return p};p.height=function(a){if(!arguments.length)return D+t.bottom+t.top;D!==a&&p.reRenderTheNextTime(!0);D=a;return p};p.whichLevelToRender=function(a){if(!arguments.length)return w;w!==a&&p.reRenderTheNextTime(!0);w=a-Math.floor(Math.log(h/5)/Math.log(2));w=Math.max(w,0);return p};p.whichLinesToRender=function(a){if(!arguments.length)return E;0===_.difference(a,E).length&&0===_.difference(E,a).length||p.reRenderTheNextTime(!0);E=a;return p};p.strokeWidth= function(a){if(!arguments.length)return d;d=a;return p};p.transitionNextTime=function(a){if(!arguments.length)return S;S=a;return p};p.reRenderTheNextTime=function(a){if(!arguments.length)return C;C=a;return p};p.xScale=function(a){if(!arguments.length)return u;u?u.domain()[0]==a.domain()[0]&&u.domain()[1]==a.domain()[1]||ha(T,u):T=d3.scale.linear();u=a;return p};p.yScale=function(a){if(!arguments.length)return B;B=a;return p};p.update=function(a){p.setSelectedLines();p(ea)};p.showTimeContext=function(a){if(!arguments.length)return z; z=a;t.top+=z?shmotg.TIME_CONTEXT_VERTICAL_EACH:0;return p};p.setSelectedLines=function(){var a=[].map.call(document.querySelectorAll("#render-lines input:checked"),justValue);p.whichLinesToRender(a);a=document.querySelector("#render-method input:checked").value;a!==y&&p.reRenderTheNextTime(!0);y=a;return p};p.uniqueID=function(a){return arguments.length?p:c+x};p.sensorType=function(a){if(!arguments.length)return c;c=a;return p};p.sensorNumber=function(a){if(!arguments.length)return x;x=a;return p}; p.yAxisLock=function(a){if(!arguments.length)return L;!0===L&&!1===a&&(p.reRenderTheNextTime(!0),L=a,p.update());L=a;return p};p.addMultiChartChild=function(a){g.push(a)};p.makeIntoMultiChart=function(a,b){v=multiData(b);for(var c=0;c<a.length;c++)p.addMultiChartParent(a[c]);p.reRenderTheNextTime(!0).update()};p.addMultiChartParent=function(a){f.push(a);v.addParentData(a.bd())};p.multiChart_parentBinnedCharts=function(a){if(!arguments.length)return f;f=a;return p};p.multiChart_childrenCharts=function(a){if(!arguments.length)return g; g=a;return p};p.displayThisChart=function(a){if(!arguments.length)return l;l=a;return p};p.binData=function(){return v};p.incomingRequestedData=function(a){var b=a.req;p.uniqueID()===""+a.sensorType+a.sensorNumber&&p.addDataToBinData(b,a.bin_level).reRenderTheNextTime(!0).update()};p.addDataToBinData=function(a,b){da=!1;var c=[],c=0===b?_.filter(a,notNaNVal):a;0!==c.length&&(0===b?v.addRawData(c):v.addBinnedData(c,b));return p};p.bd=function(){return v};return p},myLoader=loader().width(25).height(25); d3.select("#loader_container").call(myLoader);var supportsOrientationChange="onorientationchange"in window,orientationEvent=supportsOrientationChange?"orientationchange":"resize",windowListener=function(){navigator.userAgent.match(/android/i)?setTimeout(redraw,500):redraw()};window.addEventListener(orientationEvent,windowListener,!1);document.getElementById("render-lines").addEventListener("change",changeLines,!1);document.getElementById("render-method").addEventListener("change",changeLines,!1); var plots=[],msPS=5,margin={top:20,right:10,bottom:25,left:120},plotHeightDefault=150,zoomSVG=d3.select("#zoomSVG"),zoomRect=d3.select("#zoomRect"),zoomRectGreyOut=d3.select("#zoomRectGreyOut"),xScale=d3.scale.linear().domain([1325567551E3,1325567552E3]).range([0,document.getElementById("chartContainer").offsetWidth]),yScale=d3.scale.linear(),duration=500,sliderContainerName="#slider_container",curLevel=0,curPos=0,boxSize=34,sliderCallBack=function(a,b,e){if(curLevel!==b){for(var k=0;k<plots.length;k++)plots[k].whichLevelToRender(b).update(); curLevel=b}curPos!==a&&(b=Math.pow(2,a/boxSize),e||rescaleTo(b),curPos=a)},mySlider=slider().height(200).width(2.5*boxSize).boxSize(boxSize).changeCallBack(sliderCallBack).numberOfLevels(33);d3.select(sliderContainerName).call(mySlider);var copyScaleWithoutGarbage=function(a,b){a.domain()[0]=b.domain()[0];a.domain()[1]=b.domain()[1];a.range()[0]=b.range()[0];a.range()[1]=b.range()[1]};function swapItems(a,b,e){a[b]=a.splice(e,1,a[b])[0];return a} function insertItem(a,b,e){a.splice(e,0,b);return a}function insertItemBeforeItem(a,b,e){a.splice(a.indexOf(e),0,b);return a}var getTotalChartHeight=function(a){var b=0;_.each(a,function(a,k){b+=a.height()});return b},setAllYAxisLocks=function(a){for(var b=0;b<plots.length;b++)plots[b].yAxisLock(a)};function insertBeforeDOMPlot(a,b){var e=document.getElementById("charts"),k=e.childNodes;e.insertBefore(k[a],k[b])} function plots_filtered(){return _.filter(plots,function(a){return a.displayThisChart()})} var redraw=function(){var a=d3.select("#charts").selectAll("svg").data(plots_filtered(),function(a,b){return a.uniqueID()});a.enter().append("svg").attr("id",function(a,b){return a.sensorType()+a.sensorNumber()});a.exit().remove();a.call(function(a){a=a[0];for(var b=0;b<a.length;b++)d3.select(a[b]).call(plots_filtered()[b])});for(var a=_.map(plots,function(a){return a.sensorType()+"_"+a.sensorNumber()}),b=_.difference("girder_6 girder_18 girder_19 girder_20 girder_22 girder_40 girder_45".split(" "),a), a=_.map(b,function(a){a=a.split("_");var b=a[0],e=parseInt(a[1]);return{sensorNumber:function(){return e},sensorType:function(){return b}}}),e=plots[0]?plots[0].height():plotHeightDefault+margin.top+margin.bottom,b=document.getElementById("edit").checked?b.length*e:0,k=0,h=plots.length;k<h;k++)plots[k].containerWidth(document.getElementById("chartContainer").offsetWidth).update();d3.select("#charts").attr("width",document.getElementById("chartContainer").offsetWidth);zoomSVG.attr("width",document.getElementById("chartContainer").offsetWidth).transition().duration(duration).attr("height", getTotalChartHeight(plots_filtered())+b);zoomRect.attr("width",document.getElementById("chartContainer").offsetWidth-margin.left-margin.right-16).attr("transform","translate("+margin.left+", "+(margin.top+8)+")").attr("height",Math.max(0,getTotalChartHeight(plots_filtered())-8));zoomRectGreyOut.attr("width",document.getElementById("chartContainer").offsetWidth-margin.left-margin.right-16).attr("transform","translate("+margin.left+", "+(margin.top+8)+")").attr("height",Math.max(0,getTotalChartHeight(plots_filtered())- 8)).style("opacity",0.15).style("fill","#000");b=document.getElementById("chartContainer").offsetWidth-margin.right;k=d3.select("#edit_remove").selectAll("g").data(plots_filtered().concat(a),function(a){return""+a.sensorNumber()+a.sensorType()});h=k.enter().append("g").style("position","absolute");h.append("img").style("position","absolute").attr("width",70).attr("height",70).attr("cursor","pointer").attr("src","./img/remove.svg").on("click",function(a){removePlot(a)});h.append("img").style("position", "absolute").attr("width",70).attr("height",70).attr("cursor","pointer").attr("class","edit_on_top").attr("src","./img/add.svg").on("click",function(a,b){addPlot(a.sensorType(),a.sensorNumber())});k.select(".edit_on_top").transition().duration(duration).style("display","block").style("opacity",function(a){return _.contains(plots_filtered(),a)?0:1}).transition().duration(0).style("display",function(a){return _.contains(plots_filtered(),a)?"none":"block"});k.transition().duration(duration).style("left", b-70+"px").style("top",function(a,b){return b*e+(e-70)/2+"px"});k.exit().remove();k=d3.select("#edit_swap").selectAll("img").data(plots_filtered().slice(0,plots_filtered().length-1));k.enter().append("img").style("position","absolute").attr("src","./img/updown.svg").attr("width",90).attr("height",90).attr("cursor","pointer").on("click",function(a,b){var e=b+1;0>e-1||e>=plots.length||(swapItems(plots,e,e-1),insertBeforeDOMPlot(e,e-1));redraw()});k.style("left","130px").style("top",function(a,b){return e/ 2+20+b*e+(e-90)/2+"px"});k.exit().transition().duration(duration/2).style("opacity",0).transition().remove();k.exit().remove();k=d3.select("#edit_add").selectAll("text").data(a,function(a){return""+a.sensorNumber()+a.sensorType()});k.enter().append("text").attr("class","sensor_title_add").attr("cursor","default").text(function(a){return a.sensorType().capitalize()+" "+a.sensorNumber()}).style("opacity",1);k.transition().duration(duration).attr("x",b-15).attr("y",function(a,b){return getTotalChartHeight(plots_filtered())+ b*e+e/4});k.exit().transition().duration(duration/2).style("opacity",0).transition().remove();k=d3.select("#edit_mult").selectAll("img").data(plots_filtered().slice(0,plots_filtered().length-1));k.enter().append("img").style("position","absolute").attr("src","./img/mult.svg").attr("width",70).attr("height",70).attr("cursor","pointer").on("click",function(a,b){addMultiChart(b,b+1,!0);redraw()});k.style("left","220px").style("top",function(a,b){return e/2+30+b*e+(e-90)/2+"px"});k.exit().transition().duration(duration/ 2).style("opacity",0).transition().remove();k.exit().remove();k=d3.select("#edit_minus").selectAll("img").data(plots_filtered().slice(0,plots_filtered().length-1));k.enter().append("img").style("position","absolute").attr("src","./img/minus.svg").attr("width",70).attr("height",70).attr("cursor","pointer").on("click",function(a,b){addMultiChart(b,b+1,!1);redraw()});k.style("left","310px").style("top",function(a,b){return e/2+30+b*e+(e-90)/2+"px"});k.exit().transition().duration(duration/2).style("opacity", 0).transition().remove();k.exit().remove();updateZoom()}; function removePlot(a){printArrayOfPlots(plots_filtered());for(var b=_.find(plots,function(b){return a.sensorNumber()===b.sensorNumber()&&a.sensorType()===b.sensorType()}),e=0,k=b.multiChart_parentBinnedCharts().length;e<k;e++){var h=b.multiChart_parentBinnedCharts()[e];h.sensorType();h.sensorNumber();plots.splice(plots.indexOf(h),1);addPlot(h.sensorType(),h.sensorNumber())}e=_.find(plots,function(a){return a.sensorNumber()===b.sensorNumber()&&a.sensorType()===b.sensorType()});e=plots.indexOf(e); -1===e&&console.log("PLOT NOT IN PLOTS");plots.splice(e,1);redraw()}function printArrayOfPlots(a){console.log(_.map(a,function(a){return a.sensorType()+"-"+a.sensorNumber()}))} function addMultiChart(a,b,e){var k=plots[a];b=plots[b];var h=e?"x":"-",h=initPlot({},function(){},5,k.sensorType(),k.sensorNumber()+h+b.sensorNumber(),curLevel,!1,!0);h.makeIntoMultiChart([k,b],e);k.addMultiChartChild(h);b.addMultiChartChild(h);insertBeforeDOMPlot(plots_filtered().indexOf(h),a);putLastItemBeforeIndex(plots,a);k.displayThisChart(!1);b.displayThisChart(!1);redraw()}function putLastItemBeforeIndex(a,b){a.splice(b,0,a.pop());return a} function addPlot(a,b){initPlot({},sendRequestToServer,5,a,b,curLevel)}function setAllPlotLevels(){plots.forEach(function(a){a.whichLevelToRender(curLevel).update()})}function transitionAllNextTime(){plots.forEach(function(a){a.transitionNextTime(!0)})}function setLoadingIcon(a){d3.select("#loader_container").style("opacity",a?1:0);d3.selectAll(".loadingBox").style("opacity",a?1:0);myLoader.isShowing(a)} function initPlot(a,b,e,k,h,m,n,r){var q;q=binnedLineChart(a,b,k,h,e,m,n,r);q.xScale(xScale.copy());q.containerWidth(document.getElementById("chartContainer").offsetWidth).height(plotHeightDefault).showTimeContext(!0).milliSecondsPerSample(msPS);plots.push(q);redraw();d3.select("#charts").attr("height",getTotalChartHeight(plots_filtered())).attr("width",document.getElementById("chartContainer").offsetWidth);zoomRect.attr("fill","rgba(0,0,0,0)").call(zoom);updateZoom=function(){zoomAll();xScale=q.xScale(); yScale=q.yScale();zoom.x(xScale);xScale.range([0,document.getElementById("chartContainer").offsetWidth])};updateZoom();return q}var updateZoom=function(){return 0},oldXScale=d3.scale.linear(); function zoomAll(){var a=getScaleValue(xScale),b=boxSize*(Math.log(a)/Math.log(2)),a=0;if(mySlider.pastExtents(b)){b=oldXScale.copy();for(a=0;a<plots.length;a++)plots[a].xScale(b.copy()).update();xScale=b.copy();zoom.x(xScale)}else for(mySlider.scrollPosition(b).update(!0),a=0;a<plots.length;a++)plots[a].xScale(xScale).update();copyScaleWithoutGarbage(oldXScale,xScale)}var zoom=d3.behavior.zoom().on("zoom",zoomAll);function changeLines(){plots.forEach(function(a){a.setSelectedLines().update()})} function rescaleTo(a){var b=xScale.domain()[1]-xScale.domain()[0];getScaleValue(xScale);zoom.scale();a=((xScale.range()[1]-xScale.range()[0])/a-b)/2;b=d3.scale.linear().range(xScale.range());b.domain([xScale.domain()[0]-a,xScale.domain()[1]+a]);xScale=b;zoom.x(xScale);zoomAll()}function getScaleValue(a){return(a.range()[1]-a.range()[0])/(a.domain()[1]-a.domain()[0])}function zoomin(){changeZoom(function(a,b){return a+b/4},function(a,b){return a-b/4})} function zoomout(){changeZoom(function(a,b){return a-b/2},function(a,b){return a+b/2})}function scrollleft(){changeZoom(function(a,b){return a+b/4},function(a,b){return a+b/4})}function scrollright(){changeZoom(function(a,b){return a-b/4},function(a,b){return a-b/4})}var socket=io.connect("130.179.231.28:8080/"),firstTime=!0;socket.on("news",function(a){firstTime&&(firstTime=!1,socket.emit("ack","Message received!"),initPlot({},sendRequestToServer,5,"girder",18,curLevel))}); var sizeOfQueue=function(){var a=0,b;for(b in serverQueue)serverQueue.hasOwnProperty(b)&&a++;return a},removeFromQueue=function(a){delete serverQueue[a]},serverQueue={};function addToServerQueue(a){serverQueue[a.id]=a.req}var uniqueRequestID=0,listOfRequestsMade=[]; function sendRequestToServer(a){if(_.findWhere(listOfRequestsMade,{sensorNumber:a.sensorNumber,sensorType:a.sensorType,ms_start:a.ms_start,ms_end:a.ms_end,bin_level:a.bin_level}))return!1;setLoadingIcon(!0);listOfRequestsMade.push(a);a={id:uniqueRequestID,req:a};uniqueRequestID+=1;addToServerQueue(a);socket.emit("req",JSON.stringify(a));return!0}socket.on("req_data",function(a){a=JSON.parse(a);removeFromQueue(a.id);0===sizeOfQueue()&&setTimeout(disableLoadingIfQueueIsEmpty,100);for(i=0;i<plots.length;i++)plots[i].incomingRequestedData(a)}); var disableLoadingIfQueueIsEmpty=function(){0===sizeOfQueue()&&setLoadingIcon(!1)}; function offlinedata(){function a(a,b){d3.csv(a,function(a,b){var e=new Date(a.Year,a.Month-1,a.Day,a.Time[0]+""+a.Time[1]);return{val:parseFloat(a.Temp),ms:e.getTime()}},function(a,e){a?console.log("error"):b.addDataToBinData(e,0)})}function b(a,b){d3.csv(a,function(a,b){return{val:"Clear"===a.Weather||"Mainly Clear"===a.Weather?1:0,ms:(new Date(a.Year,a.Month-1,a.Day,a.Time[0]+""+a.Time[1])).getTime()}},function(a,e){a?console.log("error"):b.addDataToBinData(e,0)})}for(var e=initPlot([],function(){}, 36E5,"temperature",1,curLevel),k=initPlot([],function(){},36E5,"cloudcover",1,curLevel,!0,!0),h="weather/eng-hourly-01012012-01312012.csv weather/eng-hourly-02012012-02292012.csv weather/eng-hourly-03012012-03312012.csv weather/eng-hourly-04012012-04302012.csv weather/eng-hourly-08012011-08312011.csv weather/eng-hourly-09012011-09302011.csv weather/eng-hourly-10012011-10312011.csv weather/eng-hourly-11012011-11302011.csv weather/eng-hourly-12012011-12312011.csv".split(" "),m=0;m<h.length;m++)a(h[m], e),b(h[m],k)}rescaleTo(Math.pow(2,mySlider.handlePosition()/boxSize));d3.select("#edit").on("click",toggleEditables); function toggleEditables(){document.getElementById("edit").checked?(d3.select("#edit_remove").style("display","block"),d3.select("#edit_add").style("display","block"),d3.select("#edit_swap").style("display","block"),d3.select("#edit_mult").style("display","block"),d3.select("#edit_minus").style("display","block"),d3.select("#zoomRectGreyOut").style("display","block")):(d3.select("#edit_remove").style("display","none"),d3.select("#edit_add").style("display","none"),d3.select("#edit_swap").style("display", "none"),d3.select("#edit_mult").style("display","none"),d3.select("#edit_minus").style("display","none"),d3.select("#zoomRectGreyOut").style("display","none"));redraw()}toggleEditables();
